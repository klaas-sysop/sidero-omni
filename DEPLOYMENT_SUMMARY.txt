================================================================================
SIDERO OMNI - ONE-CLICK DOCKER DEPLOYMENT
================================================================================

CREATED FILES:
==============

Core Docker Files:
  ‚úì Dockerfile                    - Custom image with cert generation
  ‚úì docker-compose.yml            - Updated to use Dockerfile
  ‚úì docker-entrypoint.sh          - Auto-setup startup script
  ‚úì generate-certs.sh             - Certificate generation helper
  ‚úì generate-gpg-key.sh           - GPG key generation helper

Configuration:
  ‚úì .env.example                  - Configuration template (with cert options)

Documentation:
  ‚úì README.md                     - Main documentation (complete rewrite)
  ‚úì DOCKERFILE_QUICKREF.md        - 2-minute quick reference
  ‚úì DOCKERFILE_GUIDE.md           - Complete Dockerfile guide
  ‚úì DEPLOYMENT_GUIDE.md           - General deployment guide
  ‚úì DOKPLOY_DEPLOYMENT.md         - Dokploy-specific instructions

Legacy (still available):
  ‚úì setup.sh                      - Manual setup script (optional)

================================================================================
QUICK START
================================================================================

1. Configure:
   cp .env.example .env
   nano .env  # Fill in: DOMAIN_NAME, PUBLIC_IP, Cloudflare credentials

2. Deploy:
   docker-compose up -d

3. Access:
   https://omni.example.com

That's it! Everything automatic:
  ‚Ä¢ SSL certificates generated (Let's Encrypt via Cloudflare)
  ‚Ä¢ GPG encryption keys created
  ‚Ä¢ Omni service started and ready

================================================================================
KEY IMPROVEMENTS
================================================================================

Before (Old):
  ‚Ä¢ Run ./setup.sh manually
  ‚Ä¢ Wait for certificates
  ‚Ä¢ docker-compose up -d
  ‚Ä¢ Separate steps needed

After (New with Dockerfile):
  ‚Ä¢ One command: docker-compose up -d
  ‚Ä¢ Everything automatic on startup
  ‚Ä¢ No pre-generation needed
  ‚Ä¢ Perfect for one-click deployment

Features:
  ‚úì Automatic SSL certificates (Let's Encrypt + Cloudflare)
  ‚úì Automatic GPG key generation
  ‚úì Self-healing (regenerates if missing)
  ‚úì Self-signed fallback (if no Cloudflare)
  ‚úì Dokploy-ready
  ‚úì Environment validation
  ‚úì Health checks
  ‚úì Production-ready

================================================================================
DOCKERFILE WORKFLOW
================================================================================

Container Startup Process:

1. Docker builds custom image (first time only)
   ‚Ä¢ Base: ghcr.io/siderolabs/omni:latest
   ‚Ä¢ Adds: certbot, DNS plugins, helper scripts

2. Container starts with entrypoint script
   ‚Ä¢ Validates all environment variables
   ‚Ä¢ Checks for existing certificates
   ‚Ä¢ If missing: generates from Let's Encrypt (if Cloudflare credentials set)
   ‚Ä¢ If missing Cloudflare: generates self-signed
   ‚Ä¢ Generates GPG encryption key (if missing)
   ‚Ä¢ Starts Omni service

3. Service running
   ‚Ä¢ Listening on port 443 (HTTPS)
   ‚Ä¢ Health check enabled
   ‚Ä¢ Ready for use

No manual intervention needed!

================================================================================
CERTIFICATE OPTIONS
================================================================================

Option 1: Automatic Let's Encrypt (RECOMMENDED)
  ‚Ä¢ Set: ENABLE_CERT_GENERATION=true
  ‚Ä¢ Set: CLOUDFLARE_API_TOKEN
  ‚Ä¢ Set: CLOUDFLARE_ZONE_ID
  ‚Ä¢ Result: Real SSL certificates auto-generated

Option 2: Self-Signed (Testing)
  ‚Ä¢ Set: ENABLE_CERT_GENERATION=true
  ‚Ä¢ Don't set Cloudflare credentials
  ‚Ä¢ Result: Self-signed certs auto-generated

Option 3: Pre-Generated (Pre-existing certs)
  ‚Ä¢ Place certs in ./certs/
  ‚Ä¢ certs won't be regenerated
  ‚Ä¢ Result: Uses your provided certificates

================================================================================
DOKPLOY DEPLOYMENT
================================================================================

Step-by-Step:

1. Push to GitHub:
   git add .
   git commit -m "Add Dockerfile deployment"
   git push origin main

2. In Dokploy Dashboard:
   Dashboard ‚Üí Projects ‚Üí Create New Project
   ‚Üí Services ‚Üí Add Service ‚Üí Docker Compose
   ‚Üí Source: Git Repository
   ‚Üí Enter repo URL
   ‚Üí Set environment variables (from .env)

3. Deploy:
   Click Deploy button
   Watch logs
   Done!

Dokploy will:
  ‚Ä¢ Build the Dockerfile
  ‚Ä¢ Start container with your .env variables
  ‚Ä¢ Container auto-generates certs and keys
  ‚Ä¢ Service starts automatically

See: DOKPLOY_DEPLOYMENT.md for detailed steps

================================================================================
DOCUMENTATION GUIDE
================================================================================

Choose based on your needs:

üéØ Just want to deploy quickly?
   ‚Üí Read: DOCKERFILE_QUICKREF.md (2 minutes)

üèóÔ∏è Self-hosting on Linux?
   ‚Üí Read: DEPLOYMENT_GUIDE.md (10 minutes)

üê≥ Want to understand Docker setup?
   ‚Üí Read: DOCKERFILE_GUIDE.md (detailed)

‚òÅÔ∏è Deploying on Dokploy?
   ‚Üí Read: DOKPLOY_DEPLOYMENT.md (step-by-step)

üìã Complete overview?
   ‚Üí Read: README.md

================================================================================
ENVIRONMENT VARIABLES
================================================================================

REQUIRED:
  DOMAIN_NAME              - Your domain (omni.example.com)
  PUBLIC_IP                - Server IP address
  LETSENCRYPT_EMAIL        - For cert notifications
  INITIAL_USERS            - Admin user email
  Auth (choose one):
    AUTH0_ENABLED + AUTH0_DOMAIN + AUTH0_CLIENT_ID
    OR SAML_ENABLED + SAML_URL
    OR OIDC_ENABLED + OIDC_PROVIDER_URL + OIDC_CLIENT_ID + OIDC_CLIENT_SECRET

OPTIONAL (auto-set):
  ACCOUNT_ID               - Will auto-generate if empty
  ENABLE_CERT_GENERATION   - Default: true
  CLOUDFLARE_API_TOKEN     - For Let's Encrypt (optional)
  CLOUDFLARE_ZONE_ID       - For Let's Encrypt (optional)

See: .env.example for all 50+ variables

================================================================================
PORTS
================================================================================

443    - Omni Web UI (HTTPS)
8090   - Siderolink API
8100   - Kubernetes Proxy
8091   - Event Sink
50180  - WireGuard (VPN)

================================================================================
TROUBLESHOOTING
================================================================================

Certificates won't generate?
  ‚Ä¢ Check DNS: nslookup omni.example.com
  ‚Ä¢ Test Cloudflare API token
  ‚Ä¢ Check logs: docker-compose logs omni

Container won't start?
  ‚Ä¢ Check logs: docker-compose logs omni
  ‚Ä¢ Rebuild: docker-compose build --no-cache
  ‚Ä¢ Check permissions: ls -la certs/

Can't access after login?
  ‚Ä¢ Verify auth is configured in .env
  ‚Ä¢ Check logs for auth errors
  ‚Ä¢ Ensure callback URLs match in auth provider

================================================================================
MANAGEMENT COMMANDS
================================================================================

Deploy:           docker-compose up -d
Stop:             docker-compose down
Restart:          docker-compose restart omni
View logs:        docker-compose logs -f omni
Check status:     docker-compose ps
Rebuild:          docker-compose build --no-cache
Resource usage:   docker stats

Backup data:      docker-compose down && tar -czf backup.tar.gz data/
Restore data:     tar -xzf backup.tar.gz && docker-compose up -d

================================================================================
FILE STRUCTURE
================================================================================

sidero-omni/
‚îú‚îÄ‚îÄ Dockerfile                    ‚Üê Custom image definition
‚îú‚îÄ‚îÄ docker-compose.yml            ‚Üê Production configuration
‚îú‚îÄ‚îÄ docker-entrypoint.sh          ‚Üê Auto-setup script
‚îú‚îÄ‚îÄ generate-certs.sh             ‚Üê Cert helper
‚îú‚îÄ‚îÄ generate-gpg-key.sh           ‚Üê GPG key helper
‚îú‚îÄ‚îÄ setup.sh                      ‚Üê Manual setup (optional)
‚îú‚îÄ‚îÄ .env.example                  ‚Üê Configuration template
‚îú‚îÄ‚îÄ .env                          ‚Üê Your configuration (git ignored)
‚îú‚îÄ‚îÄ certs/                        ‚Üê Generated certificates (git ignored)
‚îÇ   ‚îú‚îÄ‚îÄ tls.crt
‚îÇ   ‚îú‚îÄ‚îÄ tls.key
‚îÇ   ‚îú‚îÄ‚îÄ omni.asc
‚îÇ   ‚îî‚îÄ‚îÄ cloudflare.ini
‚îú‚îÄ‚îÄ data/                         ‚Üê Persistent data (git ignored)
‚îÇ   ‚îú‚îÄ‚îÄ etcd/
‚îÇ   ‚îî‚îÄ‚îÄ state/
‚îú‚îÄ‚îÄ README.md                     ‚Üê Main documentation
‚îú‚îÄ‚îÄ DOCKERFILE_QUICKREF.md        ‚Üê Quick reference
‚îú‚îÄ‚îÄ DOCKERFILE_GUIDE.md           ‚Üê Detailed guide
‚îú‚îÄ‚îÄ DEPLOYMENT_GUIDE.md           ‚Üê General deployment
‚îú‚îÄ‚îÄ DOKPLOY_DEPLOYMENT.md         ‚Üê Dokploy guide
‚îî‚îÄ‚îÄ DEPLOYMENT_SUMMARY.txt        ‚Üê This file

================================================================================
WHAT'S CHANGED FROM ORIGINAL
================================================================================

New:
  ‚úì Dockerfile - Custom image with cert tools
  ‚úì docker-entrypoint.sh - Smart startup script
  ‚úì Helper scripts for cert/GPG generation
  ‚úì DOCKERFILE_GUIDE.md - New documentation
  ‚úì DOCKERFILE_QUICKREF.md - Quick reference
  ‚úì Updated .env.example - New cert vars
  ‚úì Updated README.md - Complete rewrite

Updated:
  ‚úì docker-compose.yml - Uses custom Dockerfile instead of ghcr.io image
  ‚úì Added cert generation environment variables

Backward Compatible:
  ‚úì setup.sh - Still available for manual pre-generation
  ‚úì Old workflow still works

================================================================================
NEXT STEPS
================================================================================

1. Edit .env.example ‚Üí Save as .env
2. Configure your domain and credentials
3. For Dokploy:
   - Push to GitHub
   - Create project in Dokploy
   - Add Docker Compose service
   - Deploy!
4. For local Docker:
   - Run: docker-compose up -d
   - Done!

See DOCKERFILE_QUICKREF.md for 2-minute overview
See DOCKERFILE_GUIDE.md for detailed information
See DOKPLOY_DEPLOYMENT.md for Dokploy steps

================================================================================
SUPPORT
================================================================================

Questions?
  ‚Ä¢ Check logs: docker-compose logs -f omni
  ‚Ä¢ See troubleshooting section in documentation
  ‚Ä¢ Check DOCKERFILE_GUIDE.md

Want to customize?
  ‚Ä¢ Edit Dockerfile for custom base image
  ‚Ä¢ Edit docker-entrypoint.sh for custom logic
  ‚Ä¢ Edit docker-compose.yml for configuration

Need to pre-generate certs?
  ‚Ä¢ Run: ./setup.sh (still available)
  ‚Ä¢ Then commit to git
  ‚Ä¢ Then deploy

================================================================================
SUMMARY
================================================================================

You now have:
  ‚úì Complete one-click deployment solution
  ‚úì Automatic SSL certificate generation
  ‚úì Automatic GPG key generation
  ‚úì Dokploy-ready configuration
  ‚úì Comprehensive documentation
  ‚úì Multiple deployment options

Quickest path to production:
  1. cp .env.example .env
  2. nano .env (fill in your values)
  3. docker-compose up -d
  4. Done!

Everything works automatically!

================================================================================
Last Updated: December 26, 2025
Created for: Sidero Omni One-Click Deployment
================================================================================
